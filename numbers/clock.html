<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Часы</title>
    <meta name="viewport" content="width=device-width" />
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- css -->
    <link rel="stylesheet" href="../static/css/numbers.css">
</head>

<body>

<!-- Menu -->
<div class="dropdown open" style="position:absolute; z-index:100; margin:.7em; cursor:pointer;">
    <span class="dropdown-toggle menu-sign" data-toggle="dropdown">&#9776;</span>
    <div class="dropdown-menu" style="font-size:1.1em;">
        <a class="dropdown-item" href="../alphabet">Алфавит</a>
        <a class="dropdown-item" href="">Время</a>
        <a class="dropdown-item" href="./">Числа</a>
        <a class="dropdown-item" href="random.html">Случайное число</a>
        <!--<div class="dropdown-divider"></div>
        <a class="dropdown-item" href="#">Separated link</a>-->
    </div>
</div>

<!-- Task -->
<div id="task"></div>

<!-- Translate button -->
<div id="translate-btn">
    <input class="btn btn-primary" type="button">
</div>

<!-- Translation -->
<div id="translation">
    <div class="translit"></div>
    <div class="hebrew"></div>
</div>

<!-- JavaScript -->
<script type="text/javascript" src="../static/js/main.js"></script>
<script type="text/javascript" src="../static/js/num_base.js"></script>
<script type="text/javascript" src="../static/js/clock.js"></script>
<script type="text/javascript" src="../static/js/numbers_base.js"></script>
<script>
/** Nodes **/
let page = $(document);
let taskArea = $('#task');
let translateBtn = $('#translate-btn').find('>input');
let translationArea = $('#translation');

/** Colors (bootstrap buttons, alerts etc.) **/
let redColor = 'red'; let greenColor = 'green'; let blueColor = 'blue'; let yellowColor = 'yellow';
let aquaColor = 'aqua'; let darkGreyColor = 'darkGrey'; let greyColor = 'grey'; let lightGreyColor = 'lightGrey';
let btnColorClass = {
    'red': 'btn-danger', 'green': 'btn-success', 'blue': 'btn-primary', 'yellow': 'btn-warning',
    'aqua': 'btn-info', 'darkGrey': 'btn-dark', 'grey': 'btn-secondary', 'lightGrey': 'btn-light'
};

/**  **/
let toLang = 'heb';
let translitLang = 'rus';

/** Functions **/
function getRandHours() {
    return getRandInt(0, 12);
}

function getRandMinutes(multiple) {
    let minutes = getRandInt(0, 60);
    // Counts with multiple if it set
    if (multiple)
        while (minutes % multiple !== 0) {
            minutes = getRandInt(0, 60);
        }
    return minutes;
}

function isTranslitLang(lang) {
    return lang === translitLang;
}
function dakot(lang) {
    /* Returns 'dakot' (minutes) word on `lang` or on hebrew */
    return (isTranslitLang(lang)) ? ' дакóт ' : ' דַקוֹת ';
}

function outputHTML(node, html) {
    $(node).html(html);
}

function outputTask(taskStr) {
    outputHTML(taskArea, taskStr);
}

function outputTranslation(translit, hebrew) {
    let translitArea = translationArea.find('.translit');
    let hebrewArea = translationArea.find('.hebrew');
    outputHTML(translitArea, translit);
    outputHTML(hebrewArea, hebrew);
}

function setBtnColor(btn, color) {
    $(btn).addClass(btnColorClass[color]);
}

function removeBtnColor(btnNode, color) {
    $(btnNode).removeClass(btnColorClass[color]);
}

function hideNode(node, time) {
    time = time || 0;
    $(node).hide(time);
}

function hideTranslation() {
    hideNode(translationArea);
}

function setMinutesLeadZero(minutes) {
    return (minutes < 10) ? '0' + minutes : minutes;
}

function formTimeStr(hrs, min) {
    return hrs + ':' + min;
}

function nodeIsDisplayed(node) {
    /* Checks whether a node is displayed or not */
    return $(node).css('display') !== 'none';
}

function translationIsHidden() {
    /* Check whether the translation is hidden */
    return !nodeIsDisplayed(translationArea);
}

function showNode(node, time) {
    /* Show not displayed node within `time` ms */
    time = time || 0;
    $(node).fadeIn(time);
}

function showTranslation() {
    showNode(translationArea, 250);
}

function setNodeValue(node, val) {
    $(node).val(val);
}

function setBtnTitle(btnNode, title) {
    setNodeValue(btnNode, title);
}

function getTranslationNode(btnNode) {
    /* Returns translation node relative to the Translate button */
    return btnNode.parentNode.nextElementSibling;
}

function translateTime(hrs, min, lang) {
    /* Translates `hrs` and `min` to `lang` and forms a string */
    let str = '';
    if (min < 40) {
        str = translateNumber(hrs, lang);
        if (min === 0) {
            str += (lang === 'rus') ? ' бидъю́к' : ' בדיוק';
        } else if (min <= 20) {
            if (min === 15) {
                str += (lang === 'rus') ? ' ва рэ́ва' : ' וַרֶבַע';
            } else {
                str += getNumPrep(min, lang);
                str += translateNumber(min, lang);
                if (min !== 20) str += dakot(lang);
            }
        } else {
            if (min === 30) {
                str += (lang === 'rus') ? ' ва хэ́ци' : ' וַחֵצִי';
            } else {
                str += ' ' + translateNumber(min, lang) + dakot(lang);  /* make male minutes */
            }
        }
    } else {
        if (min === 45) {
            str = (lang === 'rus') ? 'рэ́ва ' : 'רֶבַע ';
        } else {
            str = translateNumber(60 - min, lang) + dakot(lang);
        }
        str += (lang === 'rus') ? 'лэ ' : 'לְ';
        str += translateNumber(hrs + 1, lang);
    }
    return str;
}

function outputContent() {
    /* Outputs digital time, button title, translation (and hide it), ungreencolorize button (if there is) */
    let hours = getRandHours();
    let minutes = getRandMinutes(5);
    let translit = translateTime(hours, minutes, 'rus');
    let hebrew = translateTime(hours, minutes, 'heb');
    hours = (hours) ? hours : '00';            // '0' hours -> '00'
    minutes = setMinutesLeadZero(minutes);     // 'N' min -> '0N'
    let timeStr = formTimeStr(hours, minutes);

    outputTask(timeStr);
    setBtnTitle(translateBtn, btnTitleTranslate);
    removeBtnColor(translateBtn, greenColor);  // disable green color of the button if it set before
    outputTranslation(translit, hebrew);
    hideTranslation();
}

function showTranslationOrNewTask() {
    /* Shows task translation or a new task */
    if (translationIsHidden(translationArea)) {
        showTranslation(translationArea);
        setBtnColor(translateBtn, greenColor);
        setBtnTitle(translateBtn, btnTitleMore);
    } else {
        outputContent();
    }
}

/** Events handlers **/
/* Page load */
page.ready(outputContent());
/* Click on Translate button */
translateBtn.on('click', function() { showTranslationOrNewTask(); });
</script>

</body>
</html>